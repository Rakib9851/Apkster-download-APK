<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - FF Diamond Top-Up</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --primary: #FF6B35;
            --primary-dark: #E55A2B;
            --secondary: #4ECDC4;
            --dark: #0F0F14;
            --darker: #0A0A0E;
            --card-bg: #1A1A24;
            --card-hover: #222230;
            --text: #FFFFFF;
            --text-secondary: #B0B0C0;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
            --gradient: linear-gradient(135deg, #FF6B35 0%, #FF8E53 100%);
            --gradient-dark: linear-gradient(135deg, #E55A2B 0%, #FF6B35 100%);
        }

        body {
            background: var(--darker);
            color: var(--text);
            min-height: 100vh;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 15px;
        }

        .login-logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FF6B35, #FF8E53);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.05);
        }

        .login-btn {
            background: var(--gradient);
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            margin-top: 10px;
        }

        .login-btn:hover {
            background: var(--gradient-dark);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
            transform: translateY(-2px);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: var(--error);
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Admin Panel Styles */
        #admin-panel {
            display: none;
        }

        .sidebar {
            width: 260px;
            background: var(--dark);
            padding: 20px 0;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FF6B35, #FF8E53);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .menu {
            padding: 0 15px;
            flex: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255, 107, 53, 0.1);
            color: var(--primary);
        }

        .menu-icon {
            width: 24px;
            margin-right: 12px;
            font-size: 1.1rem;
        }

        .menu-text {
            font-weight: 500;
        }

        /* Admin Info in Sidebar */
        .admin-sidebar-info {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: auto;
        }

        .admin-details {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .admin-info-text {
            flex: 1;
        }

        .admin-name {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .admin-role {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .sidebar-logout-btn {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            color: var(--primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .sidebar-logout-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--secondary);
            color: var(--dark);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7rem;
            font-weight: bold;
            min-width: 18px;
            text-align: center;
            display: none;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        /* Header */
        .header {
            background: var(--dark);
            padding: 16px 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            background: var(--gradient);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(255, 107, 53, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Content Sections */
        .content-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--gradient-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #3d8b40;
        }

        .btn-danger {
            background: var(--error);
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        th {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .status-approved {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .status-rejected {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error);
        }

        .action-btns {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .edit-btn {
            background: rgba(78, 205, 196, 0.1);
            color: var(--secondary);
        }

        .edit-btn:hover {
            background: var(--secondary);
            color: white;
        }

        .delete-btn {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error);
        }

        .delete-btn:hover {
            background: var(--error);
            color: white;
        }

        .view-btn {
            background: rgba(255, 107, 53, 0.1);
            color: var(--primary);
        }

        .view-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.05);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        /* Hidden Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 20px;
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .close:hover {
            color: var(--text);
        }

        .user-info .info-item {
            display: flex;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-info .info-item label {
            font-weight: 600;
            width: 150px;
            color: var(--text-secondary);
        }

        .user-info .info-item span {
            flex: 1;
        }

        .balance-control {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .balance-control h4 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        /* Image Preview */
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            object-fit: cover;
            margin: 10px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Order Action Buttons */
        .order-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Slider Item */
        .slider-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .slider-preview {
            width: 100%;
            max-width: 300px;
            height: 150px;
            border-radius: 10px;
            object-fit: cover;
            margin: 10px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .add-slider-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .remove-slider-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 280px;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: flex;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 16px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .section-header .btn {
                width: 100%;
                justify-content: center;
            }

            .action-btns {
                flex-wrap: wrap;
            }

            .order-actions {
                flex-direction: column;
            }

            .order-actions .btn {
                width: 100%;
                justify-content: center;
            }

            .table-container {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 12px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 15px;
            }

            .content-section {
                padding: 16px;
            }

            .modal-content {
                width: 95%;
            }

            .login-card {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <div class="logo-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <h1>Admin Panel</h1>
            </div>
            
            <h2 class="login-title">Admin Login</h2>
            
            <div class="error-message" id="error-message"></div>
            
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="login-email" placeholder="Enter admin email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="login-password" placeholder="Enter password" required>
                </div>
                
                <button type="submit" class="login-btn" id="login-btn">
                    <span class="loading" id="login-loading"></span>
                    <span id="login-text">Login to Admin Panel</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Panel (Initially Hidden) -->
    <div id="admin-panel">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <h1>Admin Panel</h1>
            </div>
            
            <div class="menu">
                <div class="menu-item active" data-page="dashboard-page">
                    <i class="fas fa-tachometer-alt menu-icon"></i>
                    <span class="menu-text">Dashboard</span>
                </div>
                <div class="menu-item" data-page="categories-page">
                    <i class="fas fa-layer-group menu-icon"></i>
                    <span class="menu-text">Categories</span>
                    <span class="notification-badge" id="categories-badge">0</span>
                </div>
                <div class="menu-item" data-page="packages-page">
                    <i class="fas fa-cube menu-icon"></i>
                    <span class="menu-text">Packages</span>
                    <span class="notification-badge" id="packages-badge">0</span>
                </div>
                <!-- New Social Tasks Menu Item -->
                <div class="menu-item" data-page="social-tasks-page">
                    <i class="fas fa-thumbs-up menu-icon"></i>
                    <span class="menu-text">Social Tasks</span>
                    <span class="notification-badge" id="social-tasks-badge">0</span>
                </div>
                <div class="menu-item" data-page="orders-page">
                    <i class="fas fa-shopping-cart menu-icon"></i>
                    <span class="menu-text">Orders</span>
                    <span class="notification-badge" id="orders-badge">0</span>
                </div>
                <div class="menu-item" data-page="topup-requests-page">
                    <i class="fas fa-money-bill-wave menu-icon"></i>
                    <span class="menu-text">Top-up Requests</span>
                    <span class="notification-badge" id="topup-requests-badge">0</span>
                </div>
                <div class="menu-item" data-page="users-page">
                    <i class="fas fa-users menu-icon"></i>
                    <span class="menu-text">Users</span>
                    <span class="notification-badge" id="users-badge">0</span>
                </div>
                <div class="menu-item" data-page="payments-page">
                    <i class="fas fa-credit-card menu-icon"></i>
                    <span class="menu-text">Payments</span>
                </div>
                <div class="menu-item" data-page="notifications-page">
                    <i class="fas fa-bell menu-icon"></i>
                    <span class="menu-text">Notifications</span>
                </div>
                <div class="menu-item" data-page="updates-page">
                    <i class="fas fa-sync-alt menu-icon"></i>
                    <span class="menu-text">App Updates</span>
                </div>
                <div class="menu-item" data-page="settings-page">
                    <i class="fas fa-cog menu-icon"></i>
                    <span class="menu-text">Settings</span>
                </div>
            </div>
            
            <!-- Admin Info in Sidebar -->
            <div class="admin-sidebar-info">
                <div class="admin-details">
                    <div class="admin-avatar" id="admin-avatar">AD</div>
                    <div class="admin-info-text">
                        <div class="admin-name" id="admin-name">Admin User</div>
                        <div class="admin-role" id="admin-email">admin@example.com</div>
                    </div>
                </div>
                <button class="sidebar-logout-btn" id="sidebar-logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="menu-toggle" id="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title" id="page-title">Dashboard</h1>
                </div>
                <div class="header-actions">
                    <!-- Empty header actions - admin info moved to sidebar -->
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-value" id="today-orders">0</div>
                        <div class="stat-label">Today's Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-value" id="pending-topups">0</div>
                        <div class="stat-label">Pending Top-ups</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="total-revenue">à§³ 0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Recent Orders</h2>
                        <button class="btn" onclick="showPage('orders-page')">
                            <i class="fas fa-eye"></i> View All
                        </button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>User</th>
                                    <th>Package</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-orders-list">
                                <tr>
                                    <td colspan="7" class="text-center">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Recent Top-up Requests -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Recent Top-up Requests</h2>
                        <button class="btn" onclick="showPage('topup-requests-page')">
                            <i class="fas fa-eye"></i> View All
                        </button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>TrxID</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-topups-list">
                                <tr>
                                    <td colspan="7" class="text-center">Loading top-up requests...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Recent Users -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Recent Users</h2>
                        <button class="btn" onclick="showPage('users-page')">
                            <i class="fas fa-eye"></i> View All
                        </button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Balance</th>
                                    <th>Registration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-users-list">
                                <tr>
                                    <td colspan="6" class="text-center">Loading users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Categories Page -->
            <div id="categories-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Category Management</h2>
                        <button class="btn" id="add-category-btn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>

                    <!-- Category Form -->
                    <div id="category-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Category Name</label>
                            <input type="text" class="form-input" id="category-name" placeholder="Enter category name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category Image URL</label>
                            <input type="text" class="form-input" id="category-image" placeholder="Enter image URL">
                            <div id="category-image-preview" class="hidden">
                                <img src="" alt="Category Image Preview" class="image-preview">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="category-status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="save-category-btn">
                                <i class="fas fa-save"></i> Save Category
                            </button>
                            <button class="btn btn-secondary" id="cancel-category-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Categories List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Packages</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="categories-list">
                                <tr>
                                    <td colspan="5" class="text-center">Loading categories...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Packages Page -->
            <div id="packages-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Package Management</h2>
                        <button class="btn" id="add-package-btn">
                            <i class="fas fa-plus"></i> Add Package
                        </button>
                    </div>

                    <!-- Package Form -->
                    <div id="package-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="package-category">
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Package Name</label>
                                <input type="text" class="form-input" id="package-name" placeholder="Enter package name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price</label>
                                <input type="text" class="form-input" id="package-price" placeholder="Enter price">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Original Price</label>
                                <input type="text" class="form-input" id="package-original-price" placeholder="Enter original price">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="package-status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="save-package-btn">
                                <i class="fas fa-save"></i> Save Package
                            </button>
                            <button class="btn btn-secondary" id="cancel-package-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Packages List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Package Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Original Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="packages-list">
                                <tr>
                                    <td colspan="6" class="text-center">Loading packages...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Social Tasks Page (NEW) -->
            <div id="social-tasks-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Social Tasks Management</h2>
                        <button class="btn" id="add-social-task-btn">
                            <i class="fas fa-plus"></i> Add Social Task
                        </button>
                    </div>

                    <!-- Social Task Form -->
                    <div id="social-task-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Task Name</label>
                            <input type="text" class="form-input" id="social-task-name" placeholder="Enter task name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Task Image URL</label>
                            <input type="text" class="form-input" id="social-task-image" placeholder="Enter image URL">
                            <div id="social-task-image-preview" class="hidden">
                                <img src="" alt="Task Image Preview" class="image-preview">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Input Field Label</label>
                            <input type="text" class="form-input" id="social-task-input-label" placeholder="e.g., Your Email, Phone Number, or Link">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Footer Instruction</label>
                            <textarea class="form-textarea" id="social-task-footer" placeholder="Enter footer instruction for users"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="social-task-status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="save-social-task-btn">
                                <i class="fas fa-save"></i> Save Social Task
                            </button>
                            <button class="btn btn-secondary" id="cancel-social-task-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Social Tasks Categories List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Input Field</th>
                                    <th>Footer</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="social-tasks-list">
                                <tr>
                                    <td colspan="6" class="text-center">Loading social tasks...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Social Task Packages Section -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Social Task Packages</h2>
                        <button class="btn" id="add-social-task-package-btn">
                            <i class="fas fa-plus"></i> Add Package
                        </button>
                    </div>

                    <!-- Social Task Package Form -->
                    <div id="social-task-package-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Social Task Category</label>
                            <select class="form-select" id="social-task-category">
                                <option value="">Select Social Task</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Package Name</label>
                                <input type="text" class="form-input" id="social-task-package-name" placeholder="Enter package name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price</label>
                                <input type="text" class="form-input" id="social-task-package-price" placeholder="Enter price">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Original Price</label>
                                <input type="text" class="form-input" id="social-task-package-original-price" placeholder="Enter original price">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="social-task-package-status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="save-social-task-package-btn">
                                <i class="fas fa-save"></i> Save Package
                            </button>
                            <button class="btn btn-secondary" id="cancel-social-task-package-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Social Task Packages List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Package Name</th>
                                    <th>Social Task</th>
                                    <th>Price</th>
                                    <th>Original Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="social-task-packages-list">
                                <tr>
                                    <td colspan="6" class="text-center">Loading social task packages...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="orders-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Order Management</h2>
                        <div class="tabs">
                            <div class="tab active" data-status="all">All Orders</div>
                            <div class="tab" data-status="pending">Pending</div>
                            <div class="tab" data-status="approved">Approved</div>
                            <div class="tab" data-status="rejected">Rejected</div>
                        </div>
                    </div>

                    <!-- Orders List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>User</th>
                                    <th>Package</th>
                                    <th>Price</th>
                                    <th>Game ID</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="orders-list">
                                <tr>
                                    <td colspan="8" class="text-center">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Top-up Requests Page -->
            <div id="topup-requests-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Top-up Requests Management</h2>
                        <div class="tabs">
                            <div class="tab active" data-status="all">All Requests</div>
                            <div class="tab" data-status="Pending">Pending</div>
                            <div class="tab" data-status="Approved">Approved</div>
                            <div class="tab" data-status="Rejected">Rejected</div>
                        </div>
                    </div>

                    <!-- Top-up Requests List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>TrxID</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="topup-requests-list">
                                <tr>
                                    <td colspan="8" class="text-center">Loading top-up requests...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">User Management</h2>
                    </div>

                    <!-- Users List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Balance</th>
                                    <th>Total Orders</th>
                                    <th>Total Spent</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-list">
                                <tr>
                                    <td colspan="8" class="text-center">Loading users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Payments Page -->
            <div id="payments-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Payment Method Management</h2>
                        <button class="btn" id="add-payment-btn">
                            <i class="fas fa-plus"></i> Add Payment Method
                        </button>
                    </div>

                    <!-- Payment Method Form -->
                    <div id="payment-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Payment Method Name</label>
                            <input type="text" class="form-input" id="payment-name" placeholder="Enter name">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Payment Logo URL</label>
                                <input type="text" class="form-input" id="payment-logo" placeholder="Enter logo URL">
                                <div id="payment-logo-preview" class="hidden">
                                    <img src="" alt="Payment Logo Preview" class="image-preview">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">QR Code URL</label>
                                <input type="text" class="form-input" id="payment-qr" placeholder="Enter QR code URL">
                                <div id="payment-qr-preview" class="hidden">
                                    <img src="" alt="QR Code Preview" class="image-preview">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number</label>
                            <input type="text" class="form-input" id="payment-number" placeholder="Enter number">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Instructions (line by line)</label>
                            <textarea class="form-textarea" id="payment-instructions" placeholder="Enter instructions, one per line"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="payment-status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="save-payment-btn">
                                <i class="fas fa-save"></i> Save Payment Method
                            </button>
                            <button class="btn btn-secondary" id="cancel-payment-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Payment Methods List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Logo</th>
                                    <th>Name</th>
                                    <th>Number</th>
                                    <th>QR Code</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="payments-list">
                                <tr>
                                    <td colspan="6" class="text-center">Loading payment methods...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Notifications Page -->
            <div id="notifications-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Notification Management</h2>
                        <button class="btn" id="send-notification-btn">
                            <i class="fas fa-paper-plane"></i> Send Notification
                        </button>
                    </div>

                    <!-- Notification Form -->
                    <div id="notification-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Receiver</label>
                            <select class="form-select" id="notification-receiver">
                                <option value="all">All Users</option>
                                <option value="specific">Specific User</option>
                            </select>
                        </div>
                        <div class="form-group" id="specific-user-field" style="display: none;">
                            <label class="form-label">Select User</label>
                            <select class="form-select" id="notification-user">
                                <option value="">Select User</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-input" id="notification-title" placeholder="Enter notification title">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" id="notification-desc" placeholder="Enter notification description"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Icon</label>
                            <select class="form-select" id="notification-icon">
                                <option value="bell">Bell</option>
                                <option value="gift">Gift</option>
                                <option value="check-circle">Check</option>
                                <option value="exclamation-triangle">Warning</option>
                                <option value="info-circle">Info</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="send-now-btn">
                                <i class="fas fa-paper-plane"></i> Send Now
                            </button>
                            <button class="btn btn-secondary" id="cancel-notification-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Notifications List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Receiver</th>
                                    <th>Time</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="notifications-list">
                                <tr>
                                    <td colspan="5" class="text-center">Loading notifications...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- App Updates Page -->
            <div id="updates-page" class="page">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">App Updates Management</h2>
                        <button class="btn" id="add-update-btn">
                            <i class="fas fa-plus"></i> Add Update
                        </button>
                    </div>

                    <!-- Update Form -->
                    <div id="update-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Update Version</label>
                            <input type="text" class="form-input" id="update-version" placeholder="e.g., 1.2.0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Update Title</label>
                            <input type="text" class="form-input" id="update-title" placeholder="Enter update title">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Update Description</label>
                            <textarea class="form-textarea" id="update-description" placeholder="Enter update description"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">App Logo URL</label>
                                <input type="text" class="form-input" id="update-logo" placeholder="Enter app logo URL">
                                <div id="update-logo-preview" class="hidden">
                                    <img src="" alt="App Logo Preview" class="image-preview">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Download Link</label>
                                <input type="text" class="form-input" id="update-link" placeholder="Enter download link">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="update-status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="save-update-btn">
                                <i class="fas fa-save"></i> Save Update
                            </button>
                            <button class="btn btn-secondary" id="cancel-update-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Updates List -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Version</th>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Logo</th>
                                    <th>Link</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="updates-list">
                                <tr>
                                    <td colspan="7" class="text-center">Loading updates...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page">
                <div class="content-section">
                    <h2 class="section-title mb-20">System Settings</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Site Name</label>
                        <input type="text" class="form-input" id="site-name" placeholder="Enter site name">
                    </div>
                    
                    <!-- Header Logo Setting -->
                    <div class="form-group">
                        <label class="form-label">Header Logo URL</label>
                        <input type="text" class="form-input" id="header-logo" placeholder="Enter header logo URL">
                        <div id="header-logo-preview" class="hidden">
                            <img src="" alt="Header Logo Preview" class="image-preview">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Support Email</label>
                        <input type="email" class="form-input" id="support-email" placeholder="Enter support email">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Support Phone</label>
                        <input type="text" class="form-input" id="support-phone" placeholder="Enter support phone">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notice Text</label>
                        <input type="text" class="form-input" id="notice-text" placeholder="Enter notice text">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Social Media Links</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Facebook</label>
                                <input type="text" class="form-input" id="facebook-link" placeholder="Facebook page link">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telegram</label>
                                <input type="text" class="form-input" id="telegram-link" placeholder="Telegram group link">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">YouTube</label>
                                <input type="text" class="form-input" id="youtube-link" placeholder="YouTube channel link">
                            </div>
                            <div class="form-group">
                                <label class="form-label">WhatsApp</label>
                                <input type="text" class="form-input" id="whatsapp-link" placeholder="WhatsApp link">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Slider Management</label>
                        <div id="slider-container">
                            <!-- Slider items will be added here -->
                        </div>
                        <button type="button" class="add-slider-btn" id="add-slider-btn">
                            <i class="fas fa-plus"></i> Add Slider
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Privacy Policy</label>
                        <textarea class="form-textarea" id="privacy-policy" rows="6" placeholder="Enter privacy policy..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Terms & Conditions</label>
                        <textarea class="form-textarea" id="terms-conditions" rows="6" placeholder="Enter terms & conditions..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Refund & Cancellation</label>
                        <textarea class="form-textarea" id="refund-policy" rows="6" placeholder="Enter refund & cancellation policy..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Fair Play Policy</label>
                        <textarea class="form-textarea" id="fair-play-policy" rows="6" placeholder="Enter fair play policy..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Disclaimer Text</label>
                        <textarea class="form-textarea" id="disclaimer-text" rows="4" placeholder="Enter disclaimer text..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn" id="save-settings-btn">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div id="user-details-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Details</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="user-info">
                    <div class="info-item">
                        <label>Name:</label>
                        <span id="detail-name">Loading...</span>
                    </div>
                    <div class="info-item">
                        <label>Email:</label>
                        <span id="detail-email">Loading...</span>
                    </div>
                    <div class="info-item">
                        <label>Phone:</label>
                        <span id="detail-phone">Loading...</span>
                    </div>
                    <div class="info-item">
                        <label>Registration Date:</label>
                        <span id="detail-reg-date">Loading...</span>
                    </div>
                    <div class="info-item">
                        <label>Total Orders:</label>
                        <span id="detail-total-orders">0</span>
                    </div>
                    <div class="info-item">
                        <label>Total Spent:</label>
                        <span id="detail-total-spent">à§³ 0</span>
                    </div>
                    <div class="info-item">
                        <label>Current Balance:</label>
                        <span id="detail-balance">à§³ 0</span>
                    </div>
                </div>
                
                <div class="balance-control">
                    <h4>Balance Management</h4>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" class="form-input" id="balance-amount" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" id="balance-type">
                            <option value="add">Add</option>
                            <option value="deduct">Deduct</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reason</label>
                        <input type="text" class="form-input" id="balance-reason" placeholder="Enter reason">
                    </div>
                    <button class="btn" id="update-balance-btn">Update Balance</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Status Modal -->
    <div id="order-status-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Order Status</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Order ID</label>
                    <input type="text" class="form-input" id="modal-order-id" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Package</label>
                    <input type="text" class="form-input" id="modal-package" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">User</label>
                    <input type="text" class="form-input" id="modal-user" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Status</label>
                    <input type="text" class="form-input" id="modal-current-status" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Update Status</label>
                    <div class="order-actions">
                        <button class="btn btn-success" id="activate-order-btn">
                            <i class="fas fa-check"></i> Activate
                        </button>
                        <button class="btn btn-danger" id="cancel-order-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
                <div class="form-group hidden" id="cancel-reason-group">
                    <label class="form-label">Cancellation Reason</label>
                    <textarea class="form-textarea" id="cancel-reason" placeholder="Enter reason for cancellation"></textarea>
                    <button class="btn btn-danger mt-20" id="confirm-cancel-btn">
                        <i class="fas fa-times"></i> Confirm Cancellation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Top-up Request Modal -->
    <div id="topup-request-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Top-up Request</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Transaction ID</label>
                    <input type="text" class="form-input" id="modal-transaction-id" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">User</label>
                    <input type="text" class="form-input" id="modal-transaction-user" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="text" class="form-input" id="modal-transaction-amount" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <input type="text" class="form-input" id="modal-transaction-method" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">TrxID</label>
                    <input type="text" class="form-input" id="modal-transaction-trxid" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Status</label>
                    <input type="text" class="form-input" id="modal-transaction-status" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Update Status</label>
                    <div class="order-actions">
                        <button class="btn btn-success" id="approve-topup-btn">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-danger" id="reject-topup-btn">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
                <div class="form-group hidden" id="reject-reason-group">
                    <label class="form-label">Rejection Reason</label>
                    <textarea class="form-textarea" id="reject-reason" placeholder="Enter reason for rejection"></textarea>
                    <button class="btn btn-danger mt-20" id="confirm-reject-btn">
                        <i class="fas fa-times"></i> Confirm Rejection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAz63KZOjOdv9ABzNGUG32Mk1HY9s33tA0",
            authDomain: "rrtj-top-up.firebaseapp.com",
            projectId: "rrtj-top-up",
            storageBucket: "rrtj-top-up.firebasestorage.app",
            messagingSenderId: "277239148831",
            appId: "1:277239148831:web:5d5d7ab3850d077bd4402a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Admin emails for authorization
        const ADMIN_EMAILS = ['rakibffbd66@gmail.com', 'rakibffbd66@gmail.com'];

        // Global variables
        let currentAdmin = null;
        let editingCategoryId = null;
        let editingPackageId = null;
        let editingPaymentId = null;
        let editingUpdateId = null;
        let editingSocialTaskId = null;
        let editingSocialTaskPackageId = null;
        let currentSelectedUserId = null;
        let currentSelectedOrderId = null;
        let currentSelectedTransactionId = null;

        // Notification tracking
        let lastChecked = {
            orders: null,
            topups: null,
            users: null,
            categories: null,
            packages: null,
            socialTasks: null
        };

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const loginText = document.getElementById('login-text');
        const loginLoading = document.getElementById('login-loading');
        const errorMessage = document.getElementById('error-message');
        const sidebarLogoutBtn = document.getElementById('sidebar-logout-btn');
        const adminName = document.getElementById('admin-name');
        const adminEmail = document.getElementById('admin-email');
        const adminAvatar = document.getElementById('admin-avatar');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');

        // Notification badges
        const ordersBadge = document.getElementById('orders-badge');
        const topupRequestsBadge = document.getElementById('topup-requests-badge');
        const usersBadge = document.getElementById('users-badge');
        const categoriesBadge = document.getElementById('categories-badge');
        const packagesBadge = document.getElementById('packages-badge');
        const socialTasksBadge = document.getElementById('social-tasks-badge');

        // Category Management Elements
        const addCategoryBtn = document.getElementById('add-category-btn');
        const categoryForm = document.getElementById('category-form');
        const saveCategoryBtn = document.getElementById('save-category-btn');
        const cancelCategoryBtn = document.getElementById('cancel-category-btn');
        const categoriesList = document.getElementById('categories-list');

        // Package Management Elements
        const addPackageBtn = document.getElementById('add-package-btn');
        const packageForm = document.getElementById('package-form');
        const savePackageBtn = document.getElementById('save-package-btn');
        const cancelPackageBtn = document.getElementById('cancel-package-btn');
        const packagesList = document.getElementById('packages-list');
        const packageCategorySelect = document.getElementById('package-category');

        // Social Tasks Management Elements (NEW)
        const addSocialTaskBtn = document.getElementById('add-social-task-btn');
        const socialTaskForm = document.getElementById('social-task-form');
        const saveSocialTaskBtn = document.getElementById('save-social-task-btn');
        const cancelSocialTaskBtn = document.getElementById('cancel-social-task-btn');
        const socialTasksList = document.getElementById('social-tasks-list');
        
        const addSocialTaskPackageBtn = document.getElementById('add-social-task-package-btn');
        const socialTaskPackageForm = document.getElementById('social-task-package-form');
        const saveSocialTaskPackageBtn = document.getElementById('save-social-task-package-btn');
        const cancelSocialTaskPackageBtn = document.getElementById('cancel-social-task-package-btn');
        const socialTaskPackagesList = document.getElementById('social-task-packages-list');
        const socialTaskCategorySelect = document.getElementById('social-task-category');

        // Orders Management Elements
        const ordersList = document.getElementById('orders-list');
        const recentOrdersList = document.getElementById('recent-orders-list');
        const orderTabs = document.querySelectorAll('.tab');

        // Top-up Requests Management Elements
        const topupRequestsList = document.getElementById('topup-requests-list');
        const recentTopupsList = document.getElementById('recent-topups-list');
        const topupTabs = document.querySelectorAll('#topup-requests-page .tab');

        // Users Management Elements
        const usersList = document.getElementById('users-list');
        const recentUsersList = document.getElementById('recent-users-list');

        // Payment Management Elements
        const addPaymentBtn = document.getElementById('add-payment-btn');
        const paymentForm = document.getElementById('payment-form');
        const savePaymentBtn = document.getElementById('save-payment-btn');
        const cancelPaymentBtn = document.getElementById('cancel-payment-btn');
        const paymentsList = document.getElementById('payments-list');

        // Notification Management Elements
        const sendNotificationBtn = document.getElementById('send-notification-btn');
        const notificationForm = document.getElementById('notification-form');
        const sendNowBtn = document.getElementById('send-now-btn');
        const cancelNotificationBtn = document.getElementById('cancel-notification-btn');
        const notificationsList = document.getElementById('notifications-list');

        // App Updates Management Elements
        const addUpdateBtn = document.getElementById('add-update-btn');
        const updateForm = document.getElementById('update-form');
        const saveUpdateBtn = document.getElementById('save-update-btn');
        const cancelUpdateBtn = document.getElementById('cancel-update-btn');
        const updatesList = document.getElementById('updates-list');

        // Settings Management Elements
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const addSliderBtn = document.getElementById('add-slider-btn');
        const sliderContainer = document.getElementById('slider-container');

        // Modal Elements
        const userDetailsModal = document.getElementById('user-details-modal');
        const orderStatusModal = document.getElementById('order-status-modal');
        const topupRequestModal = document.getElementById('topup-request-modal');
        const closeModal = document.querySelectorAll('.close');
        const updateBalanceBtn = document.getElementById('update-balance-btn');
        const activateOrderBtn = document.getElementById('activate-order-btn');
        const cancelOrderBtn = document.getElementById('cancel-order-btn');
        const approveTopupBtn = document.getElementById('approve-topup-btn');
        const rejectTopupBtn = document.getElementById('reject-topup-btn');
        const cancelReasonGroup = document.getElementById('cancel-reason-group');
        const rejectReasonGroup = document.getElementById('reject-reason-group');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const confirmRejectBtn = document.getElementById('confirm-reject-btn');

        // Initialize the application
        function initApp() {
            // Check if user is already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // Check if user is admin
                    if (ADMIN_EMAILS.includes(user.email)) {
                        showAdminPanel(user);
                    } else {
                        showError('à¦à¦ªà¦¨à¦¿ à¦à¦¡à¦®à¦¿à¦¨ à¦ªà§à¦¯à¦¾à¦¨à§à¦²à§ à¦à§à¦¯à¦¾à¦à§à¦¸à§à¦¸ à¦ªà¦¾à¦¬à§à¦¨ à¦¨à¦¾à¥¤ à¦¶à§à¦§à§à¦®à¦¾à¦¤à§à¦° à¦à¦¥à§à¦°à¦¾à¦à¦à¦¡ à¦à¦¡à¦®à¦¿à¦¨à¦°à¦¾ à¦²à¦à¦à¦¨ à¦à¦°à¦¤à§ à¦ªà¦¾à¦°à¦¬à§à¦¨à¥¤');
                        auth.signOut();
                        showLoginPage();
                    }
                } else {
                    showLoginPage();
                }
            });

            setupEventListeners();
            loadLastCheckedTimes();
        }

        // Load last checked times from localStorage
        function loadLastCheckedTimes() {
            const saved = localStorage.getItem('adminLastChecked');
            if (saved) {
                lastChecked = JSON.parse(saved);
            } else {
                // Initialize with current time
                const now = new Date().toISOString();
                lastChecked = {
                    orders: now,
                    topups: now,
                    users: now,
                    categories: now,
                    packages: now,
                    socialTasks: now
                };
                saveLastCheckedTimes();
            }
        }

        // Save last checked times to localStorage
        function saveLastCheckedTimes() {
            localStorage.setItem('adminLastChecked', JSON.stringify(lastChecked));
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form submission
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await loginUser();
            });

            // Logout button
            sidebarLogoutBtn.addEventListener('click', () => {
                auth.signOut();
            });

            // Mobile menu toggle
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });

            // Navigation menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const pageId = item.getAttribute('data-page');
                    showPage(pageId);
                    
                    // Update active menu item
                    menuItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');

                    // Close sidebar on mobile after selection
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('active');
                    }

                    // Reset notification badge when visiting the page
                    if (pageId === 'orders-page') {
                        resetOrdersNotification();
                    } else if (pageId === 'topup-requests-page') {
                        resetTopupRequestsNotification();
                    } else if (pageId === 'users-page') {
                        resetUsersNotification();
                    } else if (pageId === 'categories-page') {
                        resetCategoriesNotification();
                    } else if (pageId === 'packages-page') {
                        resetPackagesNotification();
                    } else if (pageId === 'social-tasks-page') {
                        resetSocialTasksNotification();
                    }
                });
            });

            // Category Management
            addCategoryBtn.addEventListener('click', () => {
                categoryForm.classList.remove('hidden');
                resetCategoryForm();
            });

            cancelCategoryBtn.addEventListener('click', () => {
                categoryForm.classList.add('hidden');
                resetCategoryForm();
            });

            saveCategoryBtn.addEventListener('click', saveCategory);

            // Category image preview
            document.getElementById('category-image').addEventListener('input', function() {
                const imageUrl = this.value;
                const preview = document.getElementById('category-image-preview');
                if (imageUrl) {
                    preview.classList.remove('hidden');
                    preview.querySelector('img').src = imageUrl;
                } else {
                    preview.classList.add('hidden');
                }
            });

            // Package Management
            addPackageBtn.addEventListener('click', () => {
                packageForm.classList.remove('hidden');
                resetPackageForm();
                populateCategorySelect();
            });

            cancelPackageBtn.addEventListener('click', () => {
                packageForm.classList.add('hidden');
                resetPackageForm();
            });

            savePackageBtn.addEventListener('click', savePackage);

            // Social Tasks Management (NEW)
            addSocialTaskBtn.addEventListener('click', () => {
                socialTaskForm.classList.remove('hidden');
                resetSocialTaskForm();
            });

            cancelSocialTaskBtn.addEventListener('click', () => {
                socialTaskForm.classList.add('hidden');
                resetSocialTaskForm();
            });

            saveSocialTaskBtn.addEventListener('click', saveSocialTask);

            // Social Task image preview
            document.getElementById('social-task-image').addEventListener('input', function() {
                const imageUrl = this.value;
                const preview = document.getElementById('social-task-image-preview');
                if (imageUrl) {
                    preview.classList.remove('hidden');
                    preview.querySelector('img').src = imageUrl;
                } else {
                    preview.classList.add('hidden');
                }
            });

            // Social Task Package Management (NEW)
            addSocialTaskPackageBtn.addEventListener('click', () => {
                socialTaskPackageForm.classList.remove('hidden');
                resetSocialTaskPackageForm();
                populateSocialTaskCategorySelect();
            });

            cancelSocialTaskPackageBtn.addEventListener('click', () => {
                socialTaskPackageForm.classList.add('hidden');
                resetSocialTaskPackageForm();
            });

            saveSocialTaskPackageBtn.addEventListener('click', saveSocialTaskPackage);

            // Orders Management
            orderTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    orderTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const status = tab.getAttribute('data-status');
                    renderOrders(status);
                });
            });

            // Top-up Requests Management
            topupTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    topupTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const status = tab.getAttribute('data-status');
                    renderTopupRequests(status);
                });
            });

            // Payment Management
            addPaymentBtn.addEventListener('click', () => {
                paymentForm.classList.remove('hidden');
                resetPaymentForm();
            });

            cancelPaymentBtn.addEventListener('click', () => {
                paymentForm.classList.add('hidden');
                resetPaymentForm();
            });

            savePaymentBtn.addEventListener('click', savePaymentMethod);

            // Payment image previews
            document.getElementById('payment-logo').addEventListener('input', function() {
                const imageUrl = this.value;
                const preview = document.getElementById('payment-logo-preview');
                if (imageUrl) {
                    preview.classList.remove('hidden');
                    preview.querySelector('img').src = imageUrl;
                } else {
                    preview.classList.add('hidden');
                }
            });

            document.getElementById('payment-qr').addEventListener('input', function() {
                const imageUrl = this.value;
                const preview = document.getElementById('payment-qr-preview');
                if (imageUrl) {
                    preview.classList.remove('hidden');
                    preview.querySelector('img').src = imageUrl;
                } else {
                    preview.classList.add('hidden');
                }
            });

            // Notification Management
            sendNotificationBtn.addEventListener('click', () => {
                notificationForm.classList.remove('hidden');
                resetNotificationForm();
                populateUserSelect();
            });

            cancelNotificationBtn.addEventListener('click', () => {
                notificationForm.classList.add('hidden');
                resetNotificationForm();
            });

            sendNowBtn.addEventListener('click', sendNotification);

            // App Updates Management
            addUpdateBtn.addEventListener('click', () => {
                updateForm.classList.remove('hidden');
                resetUpdateForm();
            });

            cancelUpdateBtn.addEventListener('click', () => {
                updateForm.classList.add('hidden');
                resetUpdateForm();
            });

            saveUpdateBtn.addEventListener('click', saveAppUpdate);

            // Update image preview
            document.getElementById('update-logo').addEventListener('input', function() {
                const imageUrl = this.value;
                const preview = document.getElementById('update-logo-preview');
                if (imageUrl) {
                    preview.classList.remove('hidden');
                    preview.querySelector('img').src = imageUrl;
                } else {
                    preview.classList.add('hidden');
                }
            });

            // Settings Management
            saveSettingsBtn.addEventListener('click', saveSystemSettings);

            // Header Logo preview
            document.getElementById('header-logo').addEventListener('input', function() {
                const imageUrl = this.value;
                const preview = document.getElementById('header-logo-preview');
                if (imageUrl) {
                    preview.classList.remove('hidden');
                    preview.querySelector('img').src = imageUrl;
                } else {
                    preview.classList.add('hidden');
                }
            });

            // Slider Management - Updated to remove title and description fields
            addSliderBtn.addEventListener('click', addSliderItem);

            // User Details Modal
            closeModal.forEach(close => {
                close.addEventListener('click', () => {
                    userDetailsModal.classList.add('hidden');
                    orderStatusModal.classList.add('hidden');
                    topupRequestModal.classList.add('hidden');
                    cancelReasonGroup.classList.add('hidden');
                    rejectReasonGroup.classList.add('hidden');
                });
            });

            updateBalanceBtn.addEventListener('click', updateUserBalance);

            // Order Status Modal
            activateOrderBtn.addEventListener('click', activateOrder);
            cancelOrderBtn.addEventListener('click', showCancelReason);
            confirmCancelBtn.addEventListener('click', cancelOrder);

            // Top-up Request Modal
            approveTopupBtn.addEventListener('click', approveTopupRequest);
            rejectTopupBtn.addEventListener('click', showRejectReason);
            confirmRejectBtn.addEventListener('click', rejectTopupRequest);

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === userDetailsModal) {
                    userDetailsModal.classList.add('hidden');
                }
                if (e.target === orderStatusModal) {
                    orderStatusModal.classList.add('hidden');
                    cancelReasonGroup.classList.add('hidden');
                }
                if (e.target === topupRequestModal) {
                    topupRequestModal.classList.add('hidden');
                    rejectReasonGroup.classList.add('hidden');
                }
            });

            // Notification receiver change
            document.getElementById('notification-receiver').addEventListener('change', (e) => {
                const specificUserField = document.getElementById('specific-user-field');
                if (e.target.value === 'specific') {
                    specificUserField.style.display = 'block';
                } else {
                    specificUserField.style.display = 'none';
                }
            });
        }

        // Login user
        async function loginUser() {
            const email = loginEmail.value;
            const password = loginPassword.value;

            if (!email || !password) {
                showError('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à¦®à§à¦à¦² à¦à¦¬à¦ à¦ªà¦¾à¦¸à¦à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦à¦­à¦¯à¦¼à¦ à¦²à¦¿à¦à§à¦¨à¥¤');
                return;
            }

            // Show loading state
            loginLoading.style.display = 'inline-block';
            loginText.textContent = 'à¦²à¦à¦à¦¨ à¦¹à¦à§à¦à§...';
            loginBtn.disabled = true;

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showError(error.message);
            } finally {
                // Reset loading state
                loginLoading.style.display = 'none';
                loginText.textContent = 'à¦à¦¡à¦®à¦¿à¦¨ à¦ªà§à¦¯à¦¾à¦¨à§à¦²à§ à¦²à¦à¦à¦¨';
                loginBtn.disabled = false;
            }
        }

        // Show login page
        function showLoginPage() {
            loginPage.style.display = 'flex';
            adminPanel.style.display = 'none';
            loginForm.reset();
            hideError();
        }

        // Show admin panel
        function showAdminPanel(user) {
            loginPage.style.display = 'none';
            adminPanel.style.display = 'block';
            
            // Update admin info
            adminName.textContent = user.email;
            adminEmail.textContent = user.email;
            adminAvatar.textContent = user.email.substring(0, 2).toUpperCase();
            currentAdmin = user;
            
            // Load admin panel data
            loadAdminData();
            setupRealTimeListeners();
            checkForNewItems();
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // Hide error message
        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Show specific page
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // Update page title
            const pageTitles = {
                'dashboard-page': 'à¦¡à§à¦¯à¦¾à¦¶à¦¬à§à¦°à§à¦¡',
                'categories-page': 'à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'packages-page': 'à¦ªà§à¦¯à¦¾à¦à§à¦ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'social-tasks-page': 'à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦à¦¸ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'orders-page': 'à¦à¦°à§à¦¡à¦¾à¦° à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'topup-requests-page': 'à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'users-page': 'à¦à¦à¦à¦¾à¦° à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'payments-page': 'à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'notifications-page': 'à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'updates-page': 'à¦à§à¦¯à¦¾à¦ª à¦à¦ªà¦¡à§à¦ à¦®à§à¦¯à¦¾à¦¨à§à¦à¦®à§à¦¨à§à¦',
                'settings-page': 'à¦¸à¦¿à¦¸à§à¦à§à¦® à¦¸à§à¦à¦¿à¦à¦¸'
            };
            
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                pageTitle.textContent = pageTitles[pageId] || 'à¦à¦¡à¦®à¦¿à¦¨ à¦ªà§à¦¯à¦¾à¦¨à§à¦²';
            }

            // Load specific page data
            if (pageId === 'categories-page') {
                renderCategories();
            } else if (pageId === 'packages-page') {
                renderPackages();
            } else if (pageId === 'social-tasks-page') {
                renderSocialTasks();
                renderSocialTaskPackages();
            } else if (pageId === 'orders-page') {
                renderOrders();
            } else if (pageId === 'topup-requests-page') {
                renderTopupRequests();
            } else if (pageId === 'users-page') {
                renderUsers();
            } else if (pageId === 'payments-page') {
                renderPaymentMethods();
            } else if (pageId === 'notifications-page') {
                renderNotifications();
            } else if (pageId === 'updates-page') {
                renderAppUpdates();
            } else if (pageId === 'settings-page') {
                loadSystemSettings();
            }
        }

        // Setup real-time listeners
        function setupRealTimeListeners() {
            // Real-time stats updates
            db.collection('users').onSnapshot(() => {
                updateStats();
                checkForNewUsers();
            });

            db.collection('orders').onSnapshot(() => {
                updateStats();
                loadRecentOrders();
                checkForNewOrders();
            });

            db.collection('transactions').onSnapshot(() => {
                updateStats();
                loadRecentTopups();
                checkForNewTopupRequests();
            });

            db.collection('categories').onSnapshot(() => {
                checkForNewCategories();
            });

            db.collection('packages').onSnapshot(() => {
                checkForNewPackages();
            });

            // NEW: Social Tasks real-time listeners
            db.collection('socialTasks').onSnapshot(() => {
                checkForNewSocialTasks();
            });

            db.collection('socialTaskPackages').onSnapshot(() => {
                checkForNewSocialTaskPackages();
            });
        }

        // Check for new items since last login
        async function checkForNewItems() {
            await checkForNewOrders();
            await checkForNewTopupRequests();
            await checkForNewUsers();
            await checkForNewCategories();
            await checkForNewPackages();
            await checkForNewSocialTasks();
            await checkForNewSocialTaskPackages();
        }

        // Check for new orders
        async function checkForNewOrders() {
            try {
                const snapshot = await db.collection('orders')
                    .where('createdAt', '>', new Date(lastChecked.orders))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    ordersBadge.textContent = newCount;
                    ordersBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new orders:', error);
            }
        }

        // Check for new top-up requests
        async function checkForNewTopupRequests() {
            try {
                const snapshot = await db.collection('transactions')
                    .where('createdAt', '>', new Date(lastChecked.topups))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    topupRequestsBadge.textContent = newCount;
                    topupRequestsBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new top-up requests:', error);
            }
        }

        // Check for new users
        async function checkForNewUsers() {
            try {
                const snapshot = await db.collection('users')
                    .where('createdAt', '>', new Date(lastChecked.users))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    usersBadge.textContent = newCount;
                    usersBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new users:', error);
            }
        }

        // Check for new categories
        async function checkForNewCategories() {
            try {
                const snapshot = await db.collection('categories')
                    .where('createdAt', '>', new Date(lastChecked.categories))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    categoriesBadge.textContent = newCount;
                    categoriesBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new categories:', error);
            }
        }

        // Check for new packages
        async function checkForNewPackages() {
            try {
                const snapshot = await db.collection('packages')
                    .where('createdAt', '>', new Date(lastChecked.packages))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    packagesBadge.textContent = newCount;
                    packagesBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new packages:', error);
            }
        }

        // NEW: Check for new social tasks
        async function checkForNewSocialTasks() {
            try {
                const snapshot = await db.collection('socialTasks')
                    .where('createdAt', '>', new Date(lastChecked.socialTasks))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    socialTasksBadge.textContent = newCount;
                    socialTasksBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new social tasks:', error);
            }
        }

        // NEW: Check for new social task packages
        async function checkForNewSocialTaskPackages() {
            try {
                const snapshot = await db.collection('socialTaskPackages')
                    .where('createdAt', '>', new Date(lastChecked.socialTasks))
                    .get();
                
                const newCount = snapshot.size;
                if (newCount > 0) {
                    socialTasksBadge.textContent = newCount;
                    socialTasksBadge.style.display = 'inline';
                }
            } catch (error) {
                console.error('Error checking new social task packages:', error);
            }
        }

        // Reset orders notification
        function resetOrdersNotification() {
            lastChecked.orders = new Date().toISOString();
            saveLastCheckedTimes();
            ordersBadge.style.display = 'none';
        }

        // Reset top-up requests notification
        function resetTopupRequestsNotification() {
            lastChecked.topups = new Date().toISOString();
            saveLastCheckedTimes();
            topupRequestsBadge.style.display = 'none';
        }

        // Reset users notification
        function resetUsersNotification() {
            lastChecked.users = new Date().toISOString();
            saveLastCheckedTimes();
            usersBadge.style.display = 'none';
        }

        // Reset categories notification
        function resetCategoriesNotification() {
            lastChecked.categories = new Date().toISOString();
            saveLastCheckedTimes();
            categoriesBadge.style.display = 'none';
        }

        // Reset packages notification
        function resetPackagesNotification() {
            lastChecked.packages = new Date().toISOString();
            saveLastCheckedTimes();
            packagesBadge.style.display = 'none';
        }

        // NEW: Reset social tasks notification
        function resetSocialTasksNotification() {
            lastChecked.socialTasks = new Date().toISOString();
            saveLastCheckedTimes();
            socialTasksBadge.style.display = 'none';
        }

        // Update stats
        async function updateStats() {
            try {
                // Load users count
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('total-users').textContent = usersSnapshot.size;

                // Load today's orders
                const today = new Date().toISOString().split('T')[0];
                const ordersSnapshot = await db.collection('orders').where('date', '==', today).get();
                document.getElementById('today-orders').textContent = ordersSnapshot.size;

                // Load pending top-ups
                const pendingTopupsSnapshot = await db.collection('transactions').where('status', '==', 'Pending').get();
                document.getElementById('pending-topups').textContent = pendingTopupsSnapshot.size;

                // Calculate revenue
                let totalRevenue = 0;
                
                const allOrders = await db.collection('orders').get();
                allOrders.forEach(doc => {
                    const order = doc.data();
                    const price = parseFloat(order.price?.replace('à§³ ', '') || order.price) || 0;
                    
                    if (order.status === 'approved') {
                        totalRevenue += price;
                    }
                });

                document.getElementById('total-revenue').textContent = `à§³ ${totalRevenue}`;

            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Load admin data
        async function loadAdminData() {
            await updateStats();
            await loadRecentOrders();
            await loadRecentTopups();
            await loadRecentUsers();
        }

        // Load recent orders
        async function loadRecentOrders() {
            try {
                const snapshot = await db.collection('orders')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                renderOrdersTable(snapshot, recentOrdersList);
            } catch (error) {
                console.error('Error loading recent orders:', error);
            }
        }

        // Load recent top-up requests
        async function loadRecentTopups() {
            try {
                const snapshot = await db.collection('transactions')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                renderTopupRequestsTable(snapshot, recentTopupsList);
            } catch (error) {
                console.error('Error loading recent top-ups:', error);
            }
        }

        // Load recent users
        async function loadRecentUsers() {
            try {
                const snapshot = await db.collection('users')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                renderUsersTable(snapshot, recentUsersList, true);
            } catch (error) {
                console.error('Error loading recent users:', error);
            }
        }

        // Category Management Functions
        async function renderCategories() {
            try {
                const snapshot = await db.collection('categories').orderBy('createdAt', 'asc').get();
                categoriesList.innerHTML = '';
                
                if (snapshot.empty) {
                    categoriesList.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">à¦à§à¦¨à§ à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                // Get package counts for each category
                const packagesSnapshot = await db.collection('packages').get();
                const packageCounts = {};
                
                packagesSnapshot.forEach(doc => {
                    const pkg = doc.data();
                    if (pkg.categoryId) {
                        packageCounts[pkg.categoryId] = (packageCounts[pkg.categoryId] || 0) + 1;
                    }
                });
                
                snapshot.forEach(doc => {
                    const category = { id: doc.id, ...doc.data() };
                    const packageCount = packageCounts[category.id] || 0;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            ${category.image ? 
                                `<img src="${category.image}" alt="${category.name}" class="image-preview">` : 
                                '<i class="fas fa-image" style="font-size: 2rem; color: var(--text-secondary);"></i>'
                            }
                        </td>
                        <td>${category.name}</td>
                        <td><span class="status ${category.status === 'active' ? 'status-approved' : 'status-rejected'}">${category.status === 'active' ? 'Active' : 'Inactive'}</span></td>
                        <td>${packageCount}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="editCategory('${category.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteCategory('${category.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    categoriesList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function resetCategoryForm() {
            document.getElementById('category-name').value = '';
            document.getElementById('category-image').value = '';
            document.getElementById('category-status').value = 'active';
            editingCategoryId = null;
            saveCategoryBtn.innerHTML = '<i class="fas fa-save"></i> à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¸à§à¦­ à¦à¦°à§à¦¨';
        }

        async function saveCategory() {
            const name = document.getElementById('category-name').value;
            const image = document.getElementById('category-image').value;
            const status = document.getElementById('category-status').value;
            
            if (!name) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¨à¦¾à¦® à¦¦à¦¿à¦¨');
                return;
            }
            
            const categoryData = {
                name,
                image,
                status,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingCategoryId) {
                    await db.collection('categories').doc(editingCategoryId).update(categoryData);
                } else {
                    await db.collection('categories').add(categoryData);
                }
                
                categoryForm.classList.add('hidden');
                resetCategoryForm();
                alert('à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                renderCategories();
            } catch (error) {
                alert('à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function editCategory(id) {
            try {
                const doc = await db.collection('categories').doc(id).get();
                if (doc.exists) {
                    const category = doc.data();
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-image').value = category.image || '';
                    document.getElementById('category-status').value = category.status;
                    
                    editingCategoryId = id;
                    categoryForm.classList.remove('hidden');
                    saveCategoryBtn.innerHTML = '<i class="fas fa-save"></i> à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦à¦ªà¦¡à§à¦ à¦à¦°à§à¦¨';
                }
            } catch (error) {
                alert('à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deleteCategory(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('categories').doc(id).delete();
                    alert('à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderCategories();
                } catch (error) {
                    alert('à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // Package Management Functions
        async function renderPackages() {
            try {
                const snapshot = await db.collection('packages').orderBy('createdAt', 'asc').get();
                packagesList.innerHTML = '';
                
                if (snapshot.empty) {
                    packagesList.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">à¦à§à¦¨à§ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                // Get all categories for name lookup
                const categoriesSnapshot = await db.collection('categories').get();
                const categoriesMap = {};
                categoriesSnapshot.forEach(doc => {
                    categoriesMap[doc.id] = doc.data().name;
                });
                
                snapshot.forEach(doc => {
                    const pkg = { id: doc.id, ...doc.data() };
                    const categoryName = categoriesMap[pkg.categoryId] || 'Unknown';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${pkg.name}</td>
                        <td>${categoryName}</td>
                        <td>${pkg.price}</td>
                        <td>${pkg.originalPrice || '-'}</td>
                        <td><span class="status ${pkg.status === 'active' ? 'status-approved' : 'status-rejected'}">${pkg.status === 'active' ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="editPackage('${pkg.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deletePackage('${pkg.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    packagesList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading packages:', error);
            }
        }

        async function populateCategorySelect() {
            try {
                const snapshot = await db.collection('categories')
                    .where('status', '==', 'active')
                    .orderBy('createdAt', 'asc')
                    .get();
                
                packageCategorySelect.innerHTML = '<option value="">à¦à§à¦¯à¦¾à¦à¦¾à¦à¦°à¦¿ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦à¦¨ à¦à¦°à§à¦¨</option>';
                
                snapshot.forEach(doc => {
                    const category = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = category.name;
                    packageCategorySelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function resetPackageForm() {
            document.getElementById('package-name').value = '';
            document.getElementById('package-price').value = '';
            document.getElementById('package-original-price').value = '';
            document.getElementById('package-status').value = 'active';
            packageCategorySelect.value = '';
            editingPackageId = null;
            savePackageBtn.innerHTML = '<i class="fas fa-save"></i> à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à§à¦­ à¦à¦°à§à¦¨';
        }

        async function savePackage() {
            const categoryId = packageCategorySelect.value;
            const name = document.getElementById('package-name').value;
            const price = document.getElementById('package-price').value;
            const originalPrice = document.getElementById('package-original-price').value;
            const status = document.getElementById('package-status').value;
            
            if (!categoryId || !name || !price) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦¸à¦¬ à¦ªà§à¦°à¦¯à¦¼à§à¦à¦¨à§à¦¯à¦¼ à¦«à¦¿à¦²à§à¦¡ à¦ªà§à¦°à¦£ à¦à¦°à§à¦¨');
                return;
            }
            
            const packageData = {
                categoryId,
                name,
                price,
                originalPrice: originalPrice || '',
                status,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingPackageId) {
                    await db.collection('packages').doc(editingPackageId).update(packageData);
                } else {
                    await db.collection('packages').add(packageData);
                }
                
                packageForm.classList.add('hidden');
                resetPackageForm();
                alert('à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                renderPackages();
            } catch (error) {
                alert('à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function editPackage(id) {
            try {
                const doc = await db.collection('packages').doc(id).get();
                if (doc.exists) {
                    const pkg = doc.data();
                    
                    await populateCategorySelect();
                    
                    document.getElementById('package-category').value = pkg.categoryId;
                    document.getElementById('package-name').value = pkg.name;
                    document.getElementById('package-price').value = pkg.price;
                    document.getElementById('package-original-price').value = pkg.originalPrice || '';
                    document.getElementById('package-status').value = pkg.status;
                    
                    editingPackageId = id;
                    packageForm.classList.remove('hidden');
                    savePackageBtn.innerHTML = '<i class="fas fa-save"></i> à¦ªà§à¦¯à¦¾à¦à§à¦ à¦à¦ªà¦¡à§à¦ à¦à¦°à§à¦¨';
                }
            } catch (error) {
                alert('à¦ªà§à¦¯à¦¾à¦à§à¦ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deletePackage(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('packages').doc(id).delete();
                    alert('à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderPackages();
                } catch (error) {
                    alert('à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // NEW: Social Tasks Management Functions
        async function renderSocialTasks() {
            try {
                const snapshot = await db.collection('socialTasks').orderBy('createdAt', 'asc').get();
                socialTasksList.innerHTML = '';
                
                if (snapshot.empty) {
                    socialTasksList.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">à¦à§à¦¨à§ à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const task = { id: doc.id, ...doc.data() };
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            ${task.image ? 
                                `<img src="${task.image}" alt="${task.name}" class="image-preview">` : 
                                '<i class="fas fa-image" style="font-size: 2rem; color: var(--text-secondary);"></i>'
                            }
                        </td>
                        <td>${task.name}</td>
                        <td>${task.inputLabel || 'N/A'}</td>
                        <td>${task.footerInstruction ? task.footerInstruction.substring(0, 50) + '...' : 'N/A'}</td>
                        <td><span class="status ${task.status === 'active' ? 'status-approved' : 'status-rejected'}">${task.status === 'active' ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="editSocialTask('${task.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteSocialTask('${task.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    socialTasksList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading social tasks:', error);
            }
        }

        function resetSocialTaskForm() {
            document.getElementById('social-task-name').value = '';
            document.getElementById('social-task-image').value = '';
            document.getElementById('social-task-input-label').value = '';
            document.getElementById('social-task-footer').value = '';
            document.getElementById('social-task-status').value = 'active';
            editingSocialTaskId = null;
            saveSocialTaskBtn.innerHTML = '<i class="fas fa-save"></i> à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¸à§à¦­ à¦à¦°à§à¦¨';
        }

        async function saveSocialTask() {
            const name = document.getElementById('social-task-name').value;
            const image = document.getElementById('social-task-image').value;
            const inputLabel = document.getElementById('social-task-input-label').value;
            const footerInstruction = document.getElementById('social-task-footer').value;
            const status = document.getElementById('social-task-status').value;
            
            if (!name) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¨à¦¾à¦® à¦¦à¦¿à¦¨');
                return;
            }
            
            const socialTaskData = {
                name,
                image,
                inputLabel,
                footerInstruction,
                status,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingSocialTaskId) {
                    await db.collection('socialTasks').doc(editingSocialTaskId).update(socialTaskData);
                } else {
                    await db.collection('socialTasks').add(socialTaskData);
                }
                
                socialTaskForm.classList.add('hidden');
                resetSocialTaskForm();
                alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                renderSocialTasks();
            } catch (error) {
                alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function editSocialTask(id) {
            try {
                const doc = await db.collection('socialTasks').doc(id).get();
                if (doc.exists) {
                    const task = doc.data();
                    document.getElementById('social-task-name').value = task.name;
                    document.getElementById('social-task-image').value = task.image || '';
                    document.getElementById('social-task-input-label').value = task.inputLabel || '';
                    document.getElementById('social-task-footer').value = task.footerInstruction || '';
                    document.getElementById('social-task-status').value = task.status;
                    
                    editingSocialTaskId = id;
                    socialTaskForm.classList.remove('hidden');
                    saveSocialTaskBtn.innerHTML = '<i class="fas fa-save"></i> à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦à¦ªà¦¡à§à¦ à¦à¦°à§à¦¨';
                }
            } catch (error) {
                alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deleteSocialTask(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('socialTasks').doc(id).delete();
                    alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderSocialTasks();
                } catch (error) {
                    alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // NEW: Social Task Packages Management Functions
        async function renderSocialTaskPackages() {
            try {
                const snapshot = await db.collection('socialTaskPackages').orderBy('createdAt', 'asc').get();
                socialTaskPackagesList.innerHTML = '';
                
                if (snapshot.empty) {
                    socialTaskPackagesList.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">à¦à§à¦¨à§ à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                // Get all social tasks for name lookup
                const socialTasksSnapshot = await db.collection('socialTasks').get();
                const socialTasksMap = {};
                socialTasksSnapshot.forEach(doc => {
                    socialTasksMap[doc.id] = doc.data().name;
                });
                
                snapshot.forEach(doc => {
                    const pkg = { id: doc.id, ...doc.data() };
                    const taskName = socialTasksMap[pkg.socialTaskId] || 'Unknown';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${pkg.name}</td>
                        <td>${taskName}</td>
                        <td>${pkg.price}</td>
                        <td>${pkg.originalPrice || '-'}</td>
                        <td><span class="status ${pkg.status === 'active' ? 'status-approved' : 'status-rejected'}">${pkg.status === 'active' ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="editSocialTaskPackage('${pkg.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteSocialTaskPackage('${pkg.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    socialTaskPackagesList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading social task packages:', error);
            }
        }

        async function populateSocialTaskCategorySelect() {
            try {
                const snapshot = await db.collection('socialTasks')
                    .where('status', '==', 'active')
                    .orderBy('createdAt', 'asc')
                    .get();
                
                socialTaskCategorySelect.innerHTML = '<option value="">à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦à¦¨ à¦à¦°à§à¦¨</option>';
                
                snapshot.forEach(doc => {
                    const task = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = task.name;
                    socialTaskCategorySelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading social tasks:', error);
            }
        }

        function resetSocialTaskPackageForm() {
            document.getElementById('social-task-package-name').value = '';
            document.getElementById('social-task-package-price').value = '';
            document.getElementById('social-task-package-original-price').value = '';
            document.getElementById('social-task-package-status').value = 'active';
            socialTaskCategorySelect.value = '';
            editingSocialTaskPackageId = null;
            saveSocialTaskPackageBtn.innerHTML = '<i class="fas fa-save"></i> à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à§à¦­ à¦à¦°à§à¦¨';
        }

        async function saveSocialTaskPackage() {
            const socialTaskId = socialTaskCategorySelect.value;
            const name = document.getElementById('social-task-package-name').value;
            const price = document.getElementById('social-task-package-price').value;
            const originalPrice = document.getElementById('social-task-package-original-price').value;
            const status = document.getElementById('social-task-package-status').value;
            
            if (!socialTaskId || !name || !price) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦¸à¦¬ à¦ªà§à¦°à¦¯à¦¼à§à¦à¦¨à§à¦¯à¦¼ à¦«à¦¿à¦²à§à¦¡ à¦ªà§à¦°à¦£ à¦à¦°à§à¦¨');
                return;
            }
            
            const packageData = {
                socialTaskId,
                name,
                price,
                originalPrice: originalPrice || '',
                status,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingSocialTaskPackageId) {
                    await db.collection('socialTaskPackages').doc(editingSocialTaskPackageId).update(packageData);
                } else {
                    await db.collection('socialTaskPackages').add(packageData);
                }
                
                socialTaskPackageForm.classList.add('hidden');
                resetSocialTaskPackageForm();
                alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                renderSocialTaskPackages();
            } catch (error) {
                alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function editSocialTaskPackage(id) {
            try {
                const doc = await db.collection('socialTaskPackages').doc(id).get();
                if (doc.exists) {
                    const pkg = doc.data();
                    
                    await populateSocialTaskCategorySelect();
                    
                    document.getElementById('social-task-category').value = pkg.socialTaskId;
                    document.getElementById('social-task-package-name').value = pkg.name;
                    document.getElementById('social-task-package-price').value = pkg.price;
                    document.getElementById('social-task-package-original-price').value = pkg.originalPrice || '';
                    document.getElementById('social-task-package-status').value = pkg.status;
                    
                    editingSocialTaskPackageId = id;
                    socialTaskPackageForm.classList.remove('hidden');
                    saveSocialTaskPackageBtn.innerHTML = '<i class="fas fa-save"></i> à¦ªà§à¦¯à¦¾à¦à§à¦ à¦à¦ªà¦¡à§à¦ à¦à¦°à§à¦¨';
                }
            } catch (error) {
                alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deleteSocialTaskPackage(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('socialTaskPackages').doc(id).delete();
                    alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderSocialTaskPackages();
                } catch (error) {
                    alert('à¦¸à§à¦¶à§à¦¯à¦¾à¦² à¦à¦¾à¦¸à§à¦ à¦ªà§à¦¯à¦¾à¦à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // Orders Management Functions
        async function renderOrders(status = 'all') {
            try {
                let query = db.collection('orders');
                
                if (status !== 'all') {
                    query = query.where('status', '==', status);
                }
                
                const snapshot = await query.get();
                renderOrdersTable(snapshot, ordersList);
            } catch (error) {
                console.error('Error loading orders:', error);
                ordersList.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">à¦à¦°à§à¦¡à¦¾à¦° à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾à¥¤ à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦«à¦¾à¦¯à¦¼à¦¾à¦°à¦¸à§à¦à§à¦° à¦à¦¨à¦¡à§à¦à§à¦¸ à¦à§à¦ à¦à¦°à§à¦¨à¥¤</td>
                    </tr>
                `;
            }
        }

        function renderOrdersTable(snapshot, tableElement) {
            tableElement.innerHTML = '';
            
            if (snapshot.empty) {
                tableElement.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">à¦à§à¦¨à§ à¦à¦°à§à¦¡à¦¾à¦° à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                    </tr>
                `;
                return;
            }
            
            // Convert to array and sort by date on client side
            const ordersArray = [];
            snapshot.forEach(doc => {
                ordersArray.push({ id: doc.id, ...doc.data() });
            });
            
            // Sort by date (newest first)
            ordersArray.sort((a, b) => {
                const dateA = a.createdAt ? a.createdAt.toDate().getTime() : 0;
                const dateB = b.createdAt ? b.createdAt.toDate().getTime() : 0;
                return dateB - dateA;
            });
            
            ordersArray.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${order.id.substring(0, 8)}</td>
                    <td>${order.userName || 'N/A'}</td>
                    <td>${order.package || 'N/A'}</td>
                    <td>${order.price || 'N/A'}</td>
                    <td>${order.gameId || 'N/A'}</td>
                    <td><span class="status status-${order.status || 'pending'}">${getStatusText(order.status)}</span></td>
                    <td>${order.date || 'N/A'}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn edit-btn" onclick="showOrderStatusModal('${order.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableElement.appendChild(row);
            });
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pending',
                'approved': 'Approved',
                'rejected': 'Rejected'
            };
            return statusMap[status] || status || 'Pending';
        }

        async function showOrderStatusModal(orderId) {
            try {
                const doc = await db.collection('orders').doc(orderId).get();
                if (doc.exists) {
                    const order = doc.data();
                    document.getElementById('modal-order-id').value = `#${orderId.substring(0, 8)}`;
                    document.getElementById('modal-package').value = order.package;
                    document.getElementById('modal-user').value = order.userName;
                    document.getElementById('modal-current-status').value = getStatusText(order.status);
                    
                    currentSelectedOrderId = orderId;
                    
                    // Reset cancel reason
                    document.getElementById('cancel-reason').value = '';
                    cancelReasonGroup.classList.add('hidden');
                    
                    // Show modal
                    orderStatusModal.classList.remove('hidden');
                }
            } catch (error) {
                alert('à¦à¦°à§à¦¡à¦¾à¦° à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function activateOrder() {
            if (!currentSelectedOrderId) return;
            
            try {
                await db.collection('orders').doc(currentSelectedOrderId).update({
                    status: 'approved',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                orderStatusModal.classList.add('hidden');
                alert('à¦à¦°à§à¦¡à¦¾à¦° à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦à§à¦¯à¦¾à¦à§à¦à¦¿à¦­à§à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                renderOrders();
            } catch (error) {
                alert('à¦à¦°à§à¦¡à¦¾à¦° à¦à§à¦¯à¦¾à¦à§à¦à¦¿à¦­à§à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        function showCancelReason() {
            cancelReasonGroup.classList.remove('hidden');
        }

        async function cancelOrder() {
            if (!currentSelectedOrderId) return;
            
            const reason = document.getElementById('cancel-reason').value.trim();
            if (!reason) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à§à¦¯à¦¾à¦¨à¦¸à§à¦² à¦à¦°à¦¾à¦° à¦à¦¾à¦°à¦£ à¦²à¦¿à¦à§à¦¨');
                return;
            }
            
            try {
                await db.collection('orders').doc(currentSelectedOrderId).update({
                    status: 'rejected',
                    cancelReason: reason,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                orderStatusModal.classList.add('hidden');
                alert('à¦à¦°à§à¦¡à¦¾à¦° à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦à§à¦¯à¦¾à¦¨à¦¸à§à¦² à¦¹à¦¯à¦¼à§à¦à§!');
                renderOrders();
            } catch (error) {
                alert('à¦à¦°à§à¦¡à¦¾à¦° à¦à§à¦¯à¦¾à¦¨à¦¸à§à¦² à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        // Top-up Requests Management Functions
        async function renderTopupRequests(status = 'all') {
            try {
                let query = db.collection('transactions');
                
                if (status !== 'all') {
                    query = query.where('status', '==', status);
                }
                
                const snapshot = await query.get();
                renderTopupRequestsTable(snapshot, topupRequestsList);
            } catch (error) {
                console.error('Error loading top-up requests:', error);
                topupRequestsList.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾à¥¤ à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦«à¦¾à¦¯à¦¼à¦¾à¦°à¦¸à§à¦à§à¦° à¦à¦¨à¦¡à§à¦à§à¦¸ à¦à§à¦ à¦à¦°à§à¦¨à¥¤</td>
                    </tr>
                `;
            }
        }

        function renderTopupRequestsTable(snapshot, tableElement) {
            tableElement.innerHTML = '';
            
            if (snapshot.empty) {
                tableElement.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">à¦à§à¦¨à§ à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                    </tr>
                `;
                return;
            }
            
            // Convert to array and sort by date on client side
            const transactionsArray = [];
            snapshot.forEach(doc => {
                transactionsArray.push({ id: doc.id, ...doc.data() });
            });
            
            // Sort by date (newest first)
            transactionsArray.sort((a, b) => {
                const dateA = a.createdAt ? a.createdAt.toDate().getTime() : 0;
                const dateB = b.createdAt ? b.createdAt.toDate().getTime() : 0;
                return dateB - dateA;
            });
            
            // Get user names for display
            const userIds = [...new Set(transactionsArray.map(t => t.userId))];
            const usersMap = {};
            
            // Fetch user data for all transactions
            Promise.all(userIds.map(userId => 
                db.collection('users').doc(userId).get().then(doc => {
                    if (doc.exists) {
                        usersMap[userId] = doc.data();
                    }
                })
            )).then(() => {
                transactionsArray.forEach(transaction => {
                    const user = usersMap[transaction.userId] || {};
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${transaction.id.substring(0, 8)}</td>
                        <td>${user.name || 'N/A'}</td>
                        <td>à§³ ${transaction.amount || 'N/A'}</td>
                        <td>${transaction.method || 'N/A'}</td>
                        <td>${transaction.trxId || 'N/A'}</td>
                        <td><span class="status status-${transaction.status || 'Pending'}">${transaction.status || 'Pending'}</span></td>
                        <td>${transaction.date || (transaction.createdAt ? new Date(transaction.createdAt.toDate()).toLocaleDateString() : 'N/A')}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="showTopupRequestModal('${transaction.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tableElement.appendChild(row);
                });
            });
        }

        async function showTopupRequestModal(transactionId) {
            try {
                const doc = await db.collection('transactions').doc(transactionId).get();
                if (doc.exists) {
                    const transaction = doc.data();
                    
                    // Get user data
                    const userDoc = await db.collection('users').doc(transaction.userId).get();
                    const user = userDoc.exists ? userDoc.data() : {};
                    
                    document.getElementById('modal-transaction-id').value = `#${transactionId.substring(0, 8)}`;
                    document.getElementById('modal-transaction-user').value = user.name || 'N/A';
                    document.getElementById('modal-transaction-amount').value = `à§³ ${transaction.amount}`;
                    document.getElementById('modal-transaction-method').value = transaction.method || 'N/A';
                    document.getElementById('modal-transaction-trxid').value = transaction.trxId || 'N/A';
                    document.getElementById('modal-transaction-status').value = transaction.status || 'Pending';
                    
                    currentSelectedTransactionId = transactionId;
                    
                    // Reset reject reason
                    document.getElementById('reject-reason').value = '';
                    rejectReasonGroup.classList.add('hidden');
                    
                    // Show modal
                    topupRequestModal.classList.remove('hidden');
                }
            } catch (error) {
                alert('à¦à§à¦°à¦¾à¦¨à¦à§à¦à¦¶à¦¨ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function approveTopupRequest() {
            if (!currentSelectedTransactionId) return;
            
            try {
                const transactionDoc = await db.collection('transactions').doc(currentSelectedTransactionId).get();
                if (transactionDoc.exists) {
                    const transaction = transactionDoc.data();
                    
                    // Update transaction status
                    await db.collection('transactions').doc(currentSelectedTransactionId).update({
                        status: 'Approved',
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update user balance
                    const userDoc = await db.collection('users').doc(transaction.userId).get();
                    if (userDoc.exists) {
                        const user = userDoc.data();
                        const newBalance = (parseFloat(user.balance) || 0) + parseFloat(transaction.amount);
                        
                        await db.collection('users').doc(transaction.userId).update({
                            balance: newBalance
                        });
                    }
                    
                    topupRequestModal.classList.add('hidden');
                    alert('à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦à§à¦¯à¦¾à¦ªà§à¦°à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderTopupRequests();
                }
            } catch (error) {
                alert('à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦à§à¦¯à¦¾à¦ªà§à¦°à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        function showRejectReason() {
            rejectReasonGroup.classList.remove('hidden');
        }

        async function rejectTopupRequest() {
            if (!currentSelectedTransactionId) return;
            
            const reason = document.getElementById('reject-reason').value.trim();
            if (!reason) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦°à¦¿à¦à§à¦à§à¦ à¦à¦°à¦¾à¦° à¦à¦¾à¦°à¦£ à¦²à¦¿à¦à§à¦¨');
                return;
            }
            
            try {
                await db.collection('transactions').doc(currentSelectedTransactionId).update({
                    status: 'Rejected',
                    rejectReason: reason,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                topupRequestModal.classList.add('hidden');
                alert('à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦°à¦¿à¦à§à¦à§à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                renderTopupRequests();
            } catch (error) {
                alert('à¦à¦ª-à¦à¦ª à¦°à¦¿à¦à§à¦¯à¦¼à§à¦¸à§à¦ à¦°à¦¿à¦à§à¦à§à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        // Users Management Functions
        async function renderUsers() {
            try {
                const snapshot = await db.collection('users').get();
                renderUsersTable(snapshot, usersList, false);
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        async function renderUsersTable(snapshot, tableElement, isRecent) {
            tableElement.innerHTML = '';
            
            if (snapshot.empty) {
                tableElement.innerHTML = `
                    <tr>
                        <td colspan="${isRecent ? '6' : '8'}" class="text-center">à¦à§à¦¨à§ à¦à¦à¦à¦¾à¦° à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                    </tr>
                `;
                return;
            }
            
            // Get orders count for each user
            const ordersSnapshot = await db.collection('orders').get();
            const userOrders = {};
            const userSpent = {};
            
            ordersSnapshot.forEach(doc => {
                const order = doc.data();
                if (order.status === 'approved') {
                    const userId = order.userId;
                    userOrders[userId] = (userOrders[userId] || 0) + 1;
                    const price = parseFloat(order.price?.replace('à§³ ', '') || order.price) || 0;
                    userSpent[userId] = (userSpent[userId] || 0) + price;
                }
            });
            
            snapshot.forEach(doc => {
                const user = { id: doc.id, ...doc.data() };
                const row = document.createElement('tr');
                
                if (isRecent) {
                    row.innerHTML = `
                        <td>${user.name || 'N/A'}</td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>à§³ ${user.balance || 0}</td>
                        <td>${user.createdAt ? new Date(user.createdAt.toDate()).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn view-btn" onclick="showUserDetails('${user.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${user.name || 'N/A'}</td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>à§³ ${user.balance || 0}</td>
                        <td>${userOrders[user.id] || 0}</td>
                        <td>à§³ ${userSpent[user.id] || 0}</td>
                        <td><span class="status ${user.status === 'active' ? 'status-approved' : 'status-rejected'}">${user.status === 'active' ? 'Active' : 'Blocked'}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn view-btn" onclick="showUserDetails('${user.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit-btn" onclick="toggleUserStatus('${user.id}', '${user.status || 'active'}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    `;
                }
                tableElement.appendChild(row);
            });
        }

        async function showUserDetails(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const user = userDoc.data();
                    
                    // Get user orders stats
                    const ordersSnapshot = await db.collection('orders')
                        .where('userId', '==', userId)
                        .get();
                    
                    let totalOrders = 0;
                    let totalSpent = 0;
                    
                    ordersSnapshot.forEach(doc => {
                        const order = doc.data();
                        if (order.status === 'approved') {
                            totalOrders++;
                            const price = parseFloat(order.price?.replace('à§³ ', '') || order.price) || 0;
                            totalSpent += price;
                        }
                    });
                    
                    document.getElementById('detail-name').textContent = user.name || 'N/A';
                    document.getElementById('detail-email').textContent = user.email || 'N/A';
                    document.getElementById('detail-phone').textContent = user.phone || 'N/A';
                    document.getElementById('detail-reg-date').textContent = user.createdAt ? 
                        new Date(user.createdAt.toDate()).toLocaleDateString() : 'N/A';
                    document.getElementById('detail-total-orders').textContent = totalOrders;
                    document.getElementById('detail-total-spent').textContent = `à§³ ${totalSpent}`;
                    document.getElementById('detail-balance').textContent = `à§³ ${user.balance || 0}`;
                    
                    currentSelectedUserId = userId;
                    userDetailsModal.classList.remove('hidden');
                }
            } catch (error) {
                alert('à¦à¦à¦à¦¾à¦° à¦¡à¦¿à¦à§à¦à¦²à¦¸ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function updateUserBalance() {
            if (!currentSelectedUserId) return;
            
            const amount = parseFloat(document.getElementById('balance-amount').value);
            const type = document.getElementById('balance-type').value;
            const reason = document.getElementById('balance-reason').value;
            
            if (!amount || amount <= 0) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à¦à¦à¦¿ à¦¬à§à¦§ à¦à§à¦¯à¦¾à¦®à¦¾à¦à¦¨à§à¦ à¦²à¦¿à¦à§à¦¨');
                return;
            }
            
            if (!reason) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à¦à¦à¦¿ à¦à¦¾à¦°à¦£ à¦²à¦¿à¦à§à¦¨');
                return;
            }
            
            try {
                const userDoc = await db.collection('users').doc(currentSelectedUserId).get();
                if (userDoc.exists) {
                    const user = userDoc.data();
                    let newBalance = parseFloat(user.balance) || 0;
                    
                    if (type === 'add') {
                        newBalance += amount;
                    } else {
                        if (newBalance < amount) {
                            alert('à¦à¦à¦à¦¾à¦°à§à¦° à¦ªà¦°à§à¦¯à¦¾à¦ªà§à¦¤ à¦¬à§à¦¯à¦¾à¦²à§à¦¨à§à¦¸ à¦¨à§à¦');
                            return;
                        }
                        newBalance -= amount;
                    }
                    
                    // Update user balance
                    await db.collection('users').doc(currentSelectedUserId).update({
                        balance: newBalance
                    });
                    
                    // Add transaction record
                    await db.collection('transactions').add({
                        userId: currentSelectedUserId,
                        type: type,
                        amount: amount,
                        reason: reason,
                        admin: currentAdmin.email,
                        date: new Date().toISOString(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update display
                    document.getElementById('detail-balance').textContent = `à§³ ${newBalance}`;
                    document.getElementById('balance-amount').value = '';
                    document.getElementById('balance-reason').value = '';
                    alert('à¦à¦à¦à¦¾à¦° à¦¬à§à¦¯à¦¾à¦²à§à¦¨à§à¦¸ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦à¦ªà¦¡à§à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderUsers();
                }
            } catch (error) {
                alert('à¦¬à§à¦¯à¦¾à¦²à§à¦¨à§à¦¸ à¦à¦ªà¦¡à§à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function toggleUserStatus(userId, currentStatus) {
            const newStatus = currentStatus === 'active' ? 'blocked' : 'active';
            
            try {
                await db.collection('users').doc(userId).update({
                    status: newStatus
                });
                
                alert(`à¦à¦à¦à¦¾à¦° ${newStatus === 'active' ? 'à¦à¦¨à¦¬à§à¦²à¦' : 'à¦¬à§à¦²à¦'} à¦¹à¦¯à¦¼à§à¦à§!`);
                renderUsers();
            } catch (error) {
                alert('à¦à¦à¦à¦¾à¦° à¦¸à§à¦à§à¦¯à¦¾à¦à¦¾à¦¸ à¦à¦ªà¦¡à§à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        // Payment Methods Management Functions
        async function renderPaymentMethods() {
            try {
                const snapshot = await db.collection('paymentMethods').get();
                paymentsList.innerHTML = '';
                
                if (snapshot.empty) {
                    paymentsList.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">à¦à§à¦¨à§ à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const payment = { id: doc.id, ...doc.data() };
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            ${payment.logo ? 
                                `<img src="${payment.logo}" alt="${payment.name}" class="image-preview">` : 
                                '<i class="fas fa-credit-card" style="font-size: 2rem; color: var(--text-secondary);"></i>'
                            }
                        </td>
                        <td>${payment.name}</td>
                        <td>${payment.number}</td>
                        <td>
                            ${payment.qrCode ? 
                                `<img src="${payment.qrCode}" alt="QR Code" class="image-preview">` : 
                                'N/A'
                            }
                        </td>
                        <td><span class="status ${payment.status === 'active' ? 'status-approved' : 'status-rejected'}">${payment.status === 'active' ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="editPaymentMethod('${payment.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deletePaymentMethod('${payment.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    paymentsList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading payment methods:', error);
            }
        }

        function resetPaymentForm() {
            document.getElementById('payment-name').value = '';
            document.getElementById('payment-logo').value = '';
            document.getElementById('payment-qr').value = '';
            document.getElementById('payment-number').value = '';
            document.getElementById('payment-instructions').value = '';
            document.getElementById('payment-status').value = 'active';
            editingPaymentId = null;
            savePaymentBtn.innerHTML = '<i class="fas fa-save"></i> à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¸à§à¦­ à¦à¦°à§à¦¨';
        }

        async function savePaymentMethod() {
            const name = document.getElementById('payment-name').value;
            const logo = document.getElementById('payment-logo').value;
            const qrCode = document.getElementById('payment-qr').value;
            const number = document.getElementById('payment-number').value;
            const instructions = document.getElementById('payment-instructions').value;
            const status = document.getElementById('payment-status').value;
            
            if (!name || !number) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¨à¦¾à¦® à¦à¦¬à¦ à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦¦à¦¿à¦¨');
                return;
            }
            
            const paymentData = {
                name,
                logo,
                qrCode,
                number,
                instructions: instructions.split('\n').filter(line => line.trim()),
                status,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingPaymentId) {
                    await db.collection('paymentMethods').doc(editingPaymentId).update(paymentData);
                } else {
                    await db.collection('paymentMethods').add(paymentData);
                }
                
                paymentForm.classList.add('hidden');
                resetPaymentForm();
                alert('à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                renderPaymentMethods();
            } catch (error) {
                alert('à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function editPaymentMethod(id) {
            try {
                const doc = await db.collection('paymentMethods').doc(id).get();
                if (doc.exists) {
                    const payment = doc.data();
                    document.getElementById('payment-name').value = payment.name;
                    document.getElementById('payment-logo').value = payment.logo || '';
                    document.getElementById('payment-qr').value = payment.qrCode || '';
                    document.getElementById('payment-number').value = payment.number;
                    document.getElementById('payment-instructions').value = Array.isArray(payment.instructions) ? 
                        payment.instructions.join('\n') : '';
                    document.getElementById('payment-status').value = payment.status;
                    
                    editingPaymentId = id;
                    paymentForm.classList.remove('hidden');
                    savePaymentBtn.innerHTML = '<i class="fas fa-save"></i> à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦à¦ªà¦¡à§à¦ à¦à¦°à§à¦¨';
                }
            } catch (error) {
                alert('à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deletePaymentMethod(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('paymentMethods').doc(id).delete();
                    alert('à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderPaymentMethods();
                } catch (error) {
                    alert('à¦ªà§à¦®à§à¦¨à§à¦ à¦®à§à¦¥à¦¡ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // Notification Management Functions
        async function renderNotifications() {
            try {
                const snapshot = await db.collection('notifications')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                notificationsList.innerHTML = '';
                
                if (snapshot.empty) {
                    notificationsList.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">à¦à§à¦¨à§ à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const notification = { id: doc.id, ...doc.data() };
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${notification.title}</td>
                        <td>${notification.description}</td>
                        <td>${notification.receiver || 'All Users'}</td>
                        <td>${notification.createdAt ? new Date(notification.createdAt.toDate()).toLocaleString() : 'N/A'}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn delete-btn" onclick="deleteNotification('${notification.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    notificationsList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function resetNotificationForm() {
            document.getElementById('notification-receiver').value = 'all';
            document.getElementById('notification-title').value = '';
            document.getElementById('notification-desc').value = '';
            document.getElementById('notification-icon').value = 'bell';
            document.getElementById('specific-user-field').style.display = 'none';
        }

        async function populateUserSelect() {
            try {
                const snapshot = await db.collection('users').get();
                const userSelect = document.getElementById('notification-user');
                userSelect.innerHTML = '<option value="">à¦à¦à¦à¦¾à¦° à¦¨à¦¿à¦°à§à¦¬à¦¾à¦à¦¨ à¦à¦°à§à¦¨</option>';
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = `${user.name} (${user.email})`;
                    userSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading users for notification:', error);
            }
        }

        async function sendNotification() {
            const receiver = document.getElementById('notification-receiver').value;
            const title = document.getElementById('notification-title').value;
            const description = document.getElementById('notification-desc').value;
            const icon = document.getElementById('notification-icon').value;
            const specificUser = document.getElementById('notification-user').value;
            
            if (!title || !description) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à¦¾à¦à¦à§à¦² à¦à¦¬à¦ à¦¡à§à¦¸à¦à§à¦°à¦¿à¦ªà¦¶à¦¨ à¦²à¦¿à¦à§à¦¨');
                return;
            }
            
            if (receiver === 'specific' && !specificUser) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦à¦à¦à¦¿ à¦à¦à¦à¦¾à¦° à¦¨à¦¿à¦°à§à¦¬à¦¾à¦à¦¨ à¦à¦°à§à¦¨');
                return;
            }
            
            const notificationData = {
                title,
                description,
                icon,
                receiver: receiver === 'specific' ? specificUser : 'all',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('notifications').add(notificationData);
                notificationForm.classList.add('hidden');
                resetNotificationForm();
                alert('à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦ªà¦¾à¦ à¦¾à¦¨à§ à¦¹à¦¯à¦¼à§à¦à§!');
                renderNotifications();
            } catch (error) {
                alert('à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦ªà¦¾à¦ à¦¾à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deleteNotification(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('notifications').doc(id).delete();
                    alert('à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderNotifications();
                } catch (error) {
                    alert('à¦¨à§à¦à¦¿à¦«à¦¿à¦à§à¦¶à¦¨ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // App Updates Management Functions
        async function renderAppUpdates() {
            try {
                const snapshot = await db.collection('appUpdates').get();
                updatesList.innerHTML = '';
                
                if (snapshot.empty) {
                    updatesList.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">à¦à§à¦¨à§ à¦à¦ªà¦¡à§à¦ à¦ªà¦¾à¦à¦¯à¦¼à¦¾ à¦¯à¦¾à¦¯à¦¼à¦¨à¦¿</td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const update = { id: doc.id, ...doc.data() };
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${update.version}</td>
                        <td>${update.title}</td>
                        <td>${update.description}</td>
                        <td>
                            ${update.logo ? 
                                `<img src="${update.logo}" alt="App Logo" class="image-preview">` : 
                                '<i class="fas fa-mobile-alt" style="font-size: 2rem; color: var(--text-secondary);"></i>'
                            }
                        </td>
                        <td><a href="${update.downloadLink}" target="_blank">Download</a></td>
                        <td><span class="status ${update.status === 'active' ? 'status-approved' : 'status-rejected'}">${update.status === 'active' ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn edit-btn" onclick="editAppUpdate('${update.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteAppUpdate('${update.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    updatesList.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading app updates:', error);
            }
        }

        function resetUpdateForm() {
            document.getElementById('update-version').value = '';
            document.getElementById('update-title').value = '';
            document.getElementById('update-description').value = '';
            document.getElementById('update-logo').value = '';
            document.getElementById('update-link').value = '';
            document.getElementById('update-status').value = 'active';
            editingUpdateId = null;
            saveUpdateBtn.innerHTML = '<i class="fas fa-save"></i> à¦à¦ªà¦¡à§à¦ à¦¸à§à¦­ à¦à¦°à§à¦¨';
        }

        async function saveAppUpdate() {
            const version = document.getElementById('update-version').value;
            const title = document.getElementById('update-title').value;
            const description = document.getElementById('update-description').value;
            const logo = document.getElementById('update-logo').value;
            const downloadLink = document.getElementById('update-link').value;
            const status = document.getElementById('update-status').value;
            
            if (!version || !title || !description || !downloadLink) {
                alert('à¦¦à¦¯à¦¼à¦¾ à¦à¦°à§ à¦¸à¦¬ à¦ªà§à¦°à¦¯à¦¼à§à¦à¦¨à§à¦¯à¦¼ à¦«à¦¿à¦²à§à¦¡ à¦ªà§à¦°à¦£ à¦à¦°à§à¦¨');
                return;
            }
            
            const updateData = {
                version,
                title,
                description,
                logo,
                downloadLink,
                status,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingUpdateId) {
                    await db.collection('appUpdates').doc(editingUpdateId).update(updateData);
                } else {
                    await db.collection('appUpdates').add(updateData);
                }
                
                updateForm.classList.add('hidden');
                resetUpdateForm();
                alert('à¦à¦ªà¦¡à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
                renderAppUpdates();
            } catch (error) {
                alert('à¦à¦ªà¦¡à§à¦ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function editAppUpdate(id) {
            try {
                const doc = await db.collection('appUpdates').doc(id).get();
                if (doc.exists) {
                    const update = doc.data();
                    document.getElementById('update-version').value = update.version;
                    document.getElementById('update-title').value = update.title;
                    document.getElementById('update-description').value = update.description;
                    document.getElementById('update-logo').value = update.logo || '';
                    document.getElementById('update-link').value = update.downloadLink;
                    document.getElementById('update-status').value = update.status;
                    
                    editingUpdateId = id;
                    updateForm.classList.remove('hidden');
                    saveUpdateBtn.innerHTML = '<i class="fas fa-save"></i> à¦à¦ªà¦¡à§à¦ à¦à¦ªà¦¡à§à¦ à¦à¦°à§à¦¨';
                }
            } catch (error) {
                alert('à¦à¦ªà¦¡à§à¦ à¦²à§à¦¡ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        async function deleteAppUpdate(id) {
            if (confirm('à¦à¦ªà¦¨à¦¿ à¦à¦¿ à¦¨à¦¿à¦¶à§à¦à¦¿à¦¤ à¦à¦ à¦à¦ªà¦¡à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦à¦¾à¦¨?')) {
                try {
                    await db.collection('appUpdates').doc(id).delete();
                    alert('à¦à¦ªà¦¡à§à¦ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¡à¦¿à¦²à¦¿à¦ à¦¹à¦¯à¦¼à§à¦à§!');
                    renderAppUpdates();
                } catch (error) {
                    alert('à¦à¦ªà¦¡à§à¦ à¦¡à¦¿à¦²à¦¿à¦ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
                }
            }
        }

        // Settings Management Functions
        async function loadSystemSettings() {
            try {
                const doc = await db.collection('settings').doc('appSettings').get();
                if (doc.exists) {
                    const settings = doc.data();
                    
                    // General Settings
                    document.getElementById('site-name').value = settings.siteName || '';
                    document.getElementById('header-logo').value = settings.headerLogo || '';
                    document.getElementById('support-email').value = settings.supportEmail || '';
                    document.getElementById('support-phone').value = settings.supportPhone || '';
                    document.getElementById('notice-text').value = settings.noticeText || '';
                    
                    // Social Media Links
                    document.getElementById('facebook-link').value = settings.facebookLink || '';
                    document.getElementById('telegram-link').value = settings.telegramLink || '';
                    document.getElementById('youtube-link').value = settings.youtubeLink || '';
                    document.getElementById('whatsapp-link').value = settings.whatsappLink || '';
                    
                    // Slider Management
                    sliderContainer.innerHTML = '';
                    if (settings.sliders && Array.isArray(settings.sliders)) {
                        settings.sliders.forEach((slider, index) => {
                            addSliderItemToDOM(slider, index);
                        });
                    }
                    
                    // Policies
                    document.getElementById('privacy-policy').value = settings.privacyPolicy || '';
                    document.getElementById('terms-conditions').value = settings.termsConditions || '';
                    document.getElementById('refund-policy').value = settings.refundPolicy || '';
                    document.getElementById('fair-play-policy').value = settings.fairPlayPolicy || '';
                    document.getElementById('disclaimer-text').value = settings.disclaimerText || '';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function addSliderItem() {
            addSliderItemToDOM({ image: '' }, sliderContainer.children.length);
        }

        function addSliderItemToDOM(slider, index) {
            const sliderItem = document.createElement('div');
            sliderItem.className = 'slider-item';
            sliderItem.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Slider Image URL ${index + 1}</label>
                    <input type="text" class="form-input slider-image" value="${slider.image}" placeholder="Enter slider image URL">
                    <div class="slider-preview-container">
                        ${slider.image ? `<img src="${slider.image}" alt="Slider Preview" class="slider-preview">` : ''}
                    </div>
                </div>
                <button type="button" class="remove-slider-btn" onclick="removeSliderItem(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            `;
            sliderContainer.appendChild(sliderItem);
            
            // Add image preview functionality
            const imageInput = sliderItem.querySelector('.slider-image');
            const previewContainer = sliderItem.querySelector('.slider-preview-container');
            
            imageInput.addEventListener('input', function() {
                const imageUrl = this.value;
                if (imageUrl) {
                    let img = previewContainer.querySelector('img');
                    if (!img) {
                        img = document.createElement('img');
                        img.className = 'slider-preview';
                        previewContainer.appendChild(img);
                    }
                    img.src = imageUrl;
                } else {
                    previewContainer.innerHTML = '';
                }
            });
        }

        function removeSliderItem(button) {
            if (sliderContainer.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('à¦à¦¨à§à¦¤à¦¤ à¦à¦à¦à¦¿ à¦¸à§à¦²à¦¾à¦à¦¡à¦¾à¦° à¦¥à¦¾à¦à¦¤à§ à¦¹à¦¬à§');
            }
        }

        async function saveSystemSettings() {
            // Collect slider data
            const sliders = [];
            const sliderItems = document.querySelectorAll('.slider-item');
            sliderItems.forEach(item => {
                const image = item.querySelector('.slider-image').value;
                if (image) {
                    sliders.push({ image });
                }
            });
            
            const settingsData = {
                // General Settings
                siteName: document.getElementById('site-name').value,
                headerLogo: document.getElementById('header-logo').value,
                supportEmail: document.getElementById('support-email').value,
                supportPhone: document.getElementById('support-phone').value,
                noticeText: document.getElementById('notice-text').value,
                
                // Social Media Links
                facebookLink: document.getElementById('facebook-link').value,
                telegramLink: document.getElementById('telegram-link').value,
                youtubeLink: document.getElementById('youtube-link').value,
                whatsappLink: document.getElementById('whatsapp-link').value,
                
                // Slider Management
                sliders: sliders,
                
                // Policies
                privacyPolicy: document.getElementById('privacy-policy').value,
                termsConditions: document.getElementById('terms-conditions').value,
                refundPolicy: document.getElementById('refund-policy').value,
                fairPlayPolicy: document.getElementById('fair-play-policy').value,
                disclaimerText: document.getElementById('disclaimer-text').value,
                
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('settings').doc('appSettings').set(settingsData, { merge: true });
                alert('à¦¸à§à¦à¦¿à¦à¦¸ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§ à¦¸à§à¦­ à¦¹à¦¯à¦¼à§à¦à§!');
            } catch (error) {
                alert('à¦¸à§à¦à¦¿à¦à¦¸ à¦¸à§à¦­ à¦à¦°à¦¤à§ à¦¸à¦®à¦¸à§à¦¯à¦¾: ' + error.message);
            }
        }

        // Initialize the application
        initApp();
    </script>
</body>
</html>